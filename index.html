<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolf vs Sheep Battle</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        #gameContainer {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #gameBoard {
            display: grid;
            gap: 1px;
            background: #ccc;
            border: 1px solid #999;
            margin: 20px 0;
        }
        .cell {
            width: 30px;
            height: 30px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        .wolf {
            color: #666;
        }
        .sheep {
            color: #999;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 4px;
        }
        .battle-log {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #f1f1f1;
            border-radius: 4px;
            margin-top: 10px;
        }
        .voting-section {
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 4px;
        }
        .animal-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .animal-card {
            background: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1>Wolf vs Sheep Battle</h1>
        
        <div class="controls">
            <button id="startGame">Start New Game</button>
            <button id="nextRound" disabled>Next Round</button>
        </div>

        <div id="gameBoard"></div>

        <div class="voting-section" id="votingSection" style="display: none;">
            <h3>Voting Phase</h3>
            <div id="votingOptions"></div>
        </div>

        <div class="status">
            <h2>Game Status</h2>
            <div id="gameStatus"></div>
            <div class="animal-stats" id="animalStats"></div>
        </div>

        <div class="battle-log">
            <h3>Battle Log</h3>
            <div id="battleLog"></div>
        </div>
    </div>

    <script>
        // Game Configuration
        const GAME_CONFIG = {
            GRID_SIZE: 20,
            MOVE_DISTANCE: 1,
            WOLF_ATTACK_RANGE: 2,
            WOLF_PACK_BONUS: 5,
            SHEEP_HERD_BONUS: 5,
        };

        // Utility Functions
        const calculateDistance = (entity1, entity2) => {
            return Math.sqrt(
                Math.pow(entity2.x - entity1.x, 2) + 
                Math.pow(entity2.y - entity1.y, 2)
            );
        };

        // Base Animal Class
        class Animal {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.health = 100;
                this.isAlive = true;
                this.votes = 0;
                this.lastAction = null;
                this.id = Math.random().toString(36).substr(2, 9);
            }

            move(dx, dy, gameState) {
                const newX = this.x + dx;
                const newY = this.y + dy;
                
                if (newX >= 0 && newX < GAME_CONFIG.GRID_SIZE && 
                    newY >= 0 && newY < GAME_CONFIG.GRID_SIZE) {
                    
                    const collision = gameState.animals.some(animal => 
                        animal !== this && 
                        animal.isAlive &&
                        animal.x === newX && 
                        animal.y === newY
                    );

                    if (!collision) {
                        this.x = newX;
                        this.y = newY;
                        return true;
                    }
                }
                return false;
            }

            takeDamage(amount) {
                this.health = Math.max(0, this.health - amount);
                if (this.health <= 0) {
                    this.isAlive = false;
                }
            }

            heal(amount) {
                this.health = Math.min(100, this.health + amount);
            }

            getNearbyAllies(gameState, range = 2) {
                return gameState.animals.filter(animal => 
                    animal !== this &&
                    animal.type === this.type &&
                    animal.isAlive &&
                    calculateDistance(this, animal) <= range
                );
            }
        }

        // Wolf Class
        class Wolf extends Animal {
            constructor(x, y) {
                super(x, y, 'wolf');
                this.attackPower = 20;
                this.stamina = 100;
            }

            attack(target, gameState) {
                if (!this.isAlive || !target.isAlive || this.stamina < 20) {
                    return null;
                }

                const distance = calculateDistance(this, target);
                if (distance > GAME_CONFIG.WOLF_ATTACK_RANGE) {
                    return `Wolf ${this.id} is too far to attack!`;
                }

                const nearbyWolves = this.getNearbyAllies(gameState);
                const packBonus = nearbyWolves.length * GAME_CONFIG.WOLF_PACK_BONUS;
                const totalDamage = this.attackPower + packBonus;
                
                target.takeDamage(totalDamage);
                this.stamina -= 20;
                this.lastAction = 'attack';
                
                return `Wolf ${this.id} attacked ${target.type} ${target.id} for ${totalDamage} damage! Target health: ${target.health}`;
            }

            rest() {
                this.stamina = Math.min(100, this.stamina + 30);
                this.lastAction = 'rest';
                return `Wolf ${this.id} rested. Stamina restored to ${this.stamina}`;
            }
        }

        // Sheep Class
        class Sheep extends Animal {
            constructor(x, y) {
                super(x, y, 'sheep');
                this.defensePower = 10;
                this.energy = 100;
            }

            defend(gameState) {
                if (this.energy < 15) {
                    return null;
                }

                const nearbySheep = this.getNearbyAllies(gameState);
                const herdBonus = nearbySheep.length * GAME_CONFIG.SHEEP_HERD_BONUS;
                const totalDefense = this.defensePower + herdBonus;
                
                this.heal(totalDefense);
                this.energy -= 15;
                this.lastAction = 'defend';
                
                return `Sheep ${this.id} defended with herd bonus! Healed for ${totalDefense}. Current health: ${this.health}`;
            }

            flee(gameState) {
                if (this.energy < 10) {
                    return null;
                }

                const wolves = gameState.animals.filter(a => a.type === 'wolf' && a.isAlive);
                if (wolves.length === 0) return null;

                const nearestWolf = wolves.reduce((nearest, wolf) => {
                    const distance = calculateDistance(this, wolf);
                    return distance < calculateDistance(this, nearest) ? wolf : nearest;
                });

                const dx = this.x - nearestWolf.x;
                const dy = this.y - nearestWolf.y;
                const magnitude = Math.sqrt(dx * dx + dy * dy);
                
                if (magnitude !== 0) {
                    const normalizedDx = Math.round(dx / magnitude);
                    const normalizedDy = Math.round(dy / magnitude);
                    
                    if (this.move(normalizedDx, normalizedDy, gameState)) {
                        this.energy -= 10;
                        this.lastAction = 'flee';
                        return `Sheep ${this.id} fled from wolf!`;
                    }
                }

                return null;
            }

            rest() {
                this.energy = Math.min(100, this.energy + 25);
                this.lastAction = 'rest';
                return `Sheep ${this.id} rested. Energy restored to ${this.energy}`;
            }
        }

        // Game State Management
        class GameState {
            constructor() {
                this.animals = [];
                this.votingOpen = false;
                this.roundNumber = 1;
                this.turnOrder = [];
                this.battleLog = [];
                this.votingTimeRemaining = 0;
            }

            addAnimal(animal) {
                this.animals.push(animal);
                this.updateTurnOrder();
            }

            updateTurnOrder() {
                this.turnOrder = [...this.animals]
                    .filter(animal => animal.isAlive)
                    .sort(() => Math.random() - 0.5);
            }

            startVoting(votingDuration = 30) {
                this.votingOpen = true;
                this.votingTimeRemaining = votingDuration;
                this.animals.forEach(animal => animal.votes = 0);
            }

            castVote(targetAnimalId) {
                if (!this.votingOpen) return false;
                
                const target = this.animals.find(a => a.id === targetAnimalId);
                if (target && target.isAlive) {
                    target.votes++;
                    return true;
                }
                return false;
            }

            endVoting() {
                this.votingOpen = false;
                const livingAnimals = this.animals.filter(a => a.isAlive);
                const winner = livingAnimals.reduce((prev, current) => 
                    (prev.votes > current.votes) ? prev : current
                );
                
                winner.heal(20);
                
                return {
                    winner,
                    voteCounts: livingAnimals.map(a => ({
                        id: a.id,
                        type: a.type,
                        votes: a.votes
                    }))
                };
            }

            checkGameOver() {
                const wolves = this.animals.filter(a => a.type === 'wolf' && a.isAlive);
                const sheep = this.animals.filter(a => a.type === 'sheep' && a.isAlive);
                
                if (wolves.length === 0) return 'Sheep Win!';
                if (sheep.length === 0) return 'Wolves Win!';
                return null;
            }

            getGameStatus() {
                return {
                    round: this.roundNumber,
                    votingOpen: this.votingOpen,
                    votingTimeRemaining: this.votingTimeRemaining,
                    animals: this.animals.map(a => ({
                        id: a.id,
                        type: a.type,
                        health: a.health,
                        isAlive: a.isAlive,
                        position: { x: a.x, y: a.y },
                        lastAction: a.lastAction,
                        votes: a.votes
                    }))
                };
            }
        }

        // Battle System
        class BattleSystem {
            constructor(gameState) {
                this.gameState = gameState;
            }

            initializeBattle(numWolves, numSheep) {
                this.gameState.animals = [];
                
                // Add wolves
                for (let i = 0; i < numWolves; i++) {
                    this.gameState.addAnimal(new Wolf(
                        Math.floor(Math.random() * GAME_CONFIG.GRID_SIZE),
                        Math.floor(Math.random() * GAME_CONFIG.GRID_SIZE)
                    ));
                }
                
                // Add sheep
                for (let i = 0; i < numSheep; i++) {
                    this.gameState.addAnimal(new Sheep(
                        Math.floor(Math.random() * GAME_CONFIG.GRID_SIZE),
                        Math.floor(Math.random() * GAME_CONFIG.GRID_SIZE)
                    ));
                }
            }

            executeRound() {
                const messages = [];
                this.gameState.updateTurnOrder();

                // Execute turns in random order
                for (const animal of this.gameState.turnOrder) {
                    if (!animal.isAlive) continue;

                    if (animal.type === 'wolf') {
                        // Wolf AI
                        const targets = this.gameState.animals.filter(a => 
                            a.type === 'sheep' && a.isAlive
                        );

                        if (targets.length > 0) {
                            const nearestSheep = targets.reduce((nearest, sheep) => {
                                const distance = calculateDistance(animal, sheep);
                                return distance < calculateDistance(animal, nearest) ? sheep : nearest;
                            });

                            const distance = calculateDistance(animal, nearestSheep);

                            if (distance <= GAME_CONFIG.WOLF_ATTACK_RANGE) {
                                const attackMessage = animal.attack(nearestSheep, this.gameState);
                                if (attackMessage) messages.push(attackMessage);
                            } else {
                                const dx = Math.sign(nearestSheep.x - animal.x);
                                const dy = Math.sign(nearestSheep.y - animal.y);
                                if (animal.move(dx, dy, this.gameState)) {
                                    messages.push(`Wolf ${animal.
